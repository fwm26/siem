<script lang="ts">
import { defineComponent } from 'vue';
import Sidebar from '@/components/Sidebar.vue';
import axios from 'axios';

// Define the Log interface
interface Log {
  id: number;
  site_url: string;
  timestamp: string;
  event: string;
  user: string;
  ip: string;
  url: string;
  method: string;
  user_agent: string;
  extra: string;
}

export default defineComponent({
  name: 'VulnerabilityScanner',
  components: {
    Sidebar, // Register Sidebar component
  },
  data() {
    return {
      logs: [] as Log[], // Initialize logs as an empty array of Log type
    };
  },
  mounted() {
    // Fetch logs when the component is mounted
    this.fetchLogs();
  },
  methods: {
    async fetchLogs() {
      try {
        const response = await axios.get('http://localhost:8000/logs', {
          headers: {
            Authorization: `Bearer ${localStorage.getItem('token')}`,
          },
        });
        this.logs = response.data as Log[]; // Cast response data as an array of Log objects
      } catch (err) {
        console.error('Error fetching logs:', err);
      }
    },
  },
});
</script>

<template>
  <div class="dashboard-container">
    <Sidebar />
    <!-- Main Content -->
    <div class="main-content">
      <div>
        <div class="http-events-section">
          <h2>Logs</h2>
          <table class="logs-table">
            <thead>
              <tr>
                <th>Site URL</th>           
                <th>Timestamp</th>
                <th>Event</th>
                <th>User</th>
                <th>IP</th>
                <th>URL</th>
                <th>Method</th>
                <th>User Agent</th>
                <th>Extra</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="log in logs" :key="log.id">
                <td>{{ log.site_url }}</td>            
                <td>{{ log.timestamp }}</td>
                <td>{{ log.event }}</td>
                <td>{{ log.user }}</td>
                <td>{{ log.ip }}</td>
                <td>{{ log.url }}</td>
                <td>{{ log.method }}</td>
                <td>{{ log.user_agent }}</td>
                <td>{{ log.extra }}</td>
              </tr>
            </tbody>
          </table>
        </div>  
      </div>
    </div>
  </div>
</template>

<style>

  body, html {
    margin: 0;
    padding: 0;
    height: 100%; /* Ensure the body and html take full height */
    overflow-x: hidden; /* Prevent horizontal scrolling */
  }

  .dashboard-container {
    display: flex;
    height: 100vh; /* Ensure it takes the full viewport height */
    width: 100vw;  /* Ensure it doesn't overflow horizontally */
  }

  .main-content {
    margin-left: 20%; /* Make space for the fixed sidebar */
    padding: 20px;
    width: 80%;
  }


/* Welcome Message */
.welcome-message h1 {
  font-family: 'Poppins', sans-serif;
  margin-left: 30px;
  margin-bottom: 20px;
}

/* Events Section */
.http-events-section {
  width: 95%;
  max-width: 1280px;
  background-color: #fff;
  padding: 30px;  /* Generous padding */
}

.events-cards-container {
  display: flex;
  justify-content: space-between;
  gap: 20px;  /* Space between cards */
}

.event-card {
  flex: 1;
  background-color: white;
  padding: 15px;  /* Generous padding */
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  text-align: center;
}

.event-card h3 {
  margin-bottom: 10px;
  font-size: 1.25rem;
  color: #0B132B;
}

.event-card p {
  font-size: 2.5rem;
  font-weight: bold;
  color: #DB162F;
}

/* Styles for the logs table */

div.http-events-section:nth-child(5) > h3:nth-child(1){
  font-size: 1.25rem;
}

.logs-table {
  width: 100%;
  border-collapse: collapse;
  font-family: 'Poppins', sans-serif;  
}

.logs-table th, .logs-table td {
  padding: 12px;
  text-align: left;
}

.logs-table th {
  background-color: #EDC9FF;
}

.logs-table tr:nth-child(even) {
  background-color: #fafafa;
}

</style>
